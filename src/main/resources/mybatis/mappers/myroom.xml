<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="myroom">
	<insert id="insertWeather" parameterType="com.vestis.vo.ClothWeatherVo">
		<selectKey keyProperty="no" resultType="int" order="BEFORE">
			select seq_cloth_weather_no.nextval from dual 
		</selectKey>
		<![CDATA[
			insert into cloth_weather
			values(#{no}, #{weatherNo}, #{temp})			
		]]>
	</insert>
	
	<insert id="insertImg" parameterType="com.vestis.vo.ImgVo">
		<selectKey keyProperty="no" resultType="int" order="BEFORE">
			select seq_img_no.nextval from dual 
		</selectKey>
		<![CDATA[
			insert into img
			values(#{no}, #{address}, #{name}, #{type}, #{sizes}, #{dbName})			
		]]>
	</insert>
	
	<insert id="insertCodi" parameterType="com.vestis.vo.CodiVo">
		<selectKey keyProperty="no" resultType="int" order="BEFORE">
			select seq_codi_no.nextval from dual 
		</selectKey>
		<![CDATA[
			insert into codi
			values(#{no}, #{userNo}, #{otherNo}, #{codiPhotoNo}, #{codiNo}, #{choose}, TO_DATE(#{codiDate},'YYYY-MM-DD hh24:mi:ss'), #{codiWeather}, TO_DATE(#{choiceDate},'YYYY-MM-DD hh24:mi:ss'), #{choiceWeather})			
		]]>
	</insert>
	
	<insert id="insertCodiCloth" parameterType="map">
		<![CDATA[
			insert into codi_cloth
			values(#{no}, #{codiNo})			
		]]>
	</insert>
	
	<select id="getCodiBookList" resultType="com.vestis.vo.CodibookVo" parameterType="map">
		<![CDATA[
			select codi.no no, person.no otherNo, person.nicname otherNicname, 
			pro_img.db_name profile,
			codiimg.db_name codi,
			wear.db_name wear,
			choose, NVL(likes, 0) likes
			from codi, person, img wear, img codiimg, img pro_img,
			     (select codi_no like_codi_no, count(like_person.person_no) likes 
                 from like_person
                 group by like_person.person_no, codi_no)
			where other_no = #{num}
		]]>
			<if test="purpose.equals('own')">
				and person_no = #{num}
			</if>
			<if test="purpose.equals('other')">
				and person_no != #{num}
			</if>
		<![CDATA[
			    and codi_no = codiimg.no
			    and codi_photo_no = wear.no
			    and profile_no = pro_img.no
			    and codi.no = like_codi_no(+)
			order by codi.no desc
		]]>
	</select>
	
	<update id="chooseClick" parameterType="int">
		<![CDATA[
			update codi
			set choose = 1
			where no = #{no}	
		]]>
	</update>
	
	<insert id="likebtnClick" parameterType="map">
		<![CDATA[
			insert into like_person
			values(#{voNo}, #{authNo})			
		]]>
	</insert>
	
	<select id="getClothList" resultType="com.vestis.vo.ClothListVo" parameterType="map">
		<![CDATA[
			select cloth.no no, db_name dbName
			from img, cloth
			where img.no = cloth.img_no
			and person_no = #{userNo}
		]]>
		<if test="type != 0">
			and type_no = #{type}
		</if>
	</select>
</mapper>