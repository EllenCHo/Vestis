<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="myroom">
	<insert id="insertWeather" parameterType="com.vestis.vo.ClothWeatherVo">
		<selectKey keyProperty="no" resultType="int" order="BEFORE">
			select seq_cloth_weather_no.nextval from dual 
		</selectKey>
		<![CDATA[
			insert into cloth_weather
			values(#{no}, #{weatherNo}, #{temp})			
		]]>
	</insert>
	
	<insert id="insertImg" parameterType="com.vestis.vo.ImgVo">
		<selectKey keyProperty="no" resultType="int" order="BEFORE">
			select seq_img_no.nextval from dual 
		</selectKey>
		<![CDATA[
			insert into img
			values(#{no}, #{address}, #{name}, #{type}, #{sizes}, #{dbName})			
		]]>
	</insert>
	
	<insert id="insertCodi" parameterType="com.vestis.vo.CodiVo">
		<![CDATA[
			insert into codi
			values(seq_codi_no.nextval, #{userNo}, #{otherNo}, #{codiPhotoNo}, #{codiNo}, #{choose}, TO_DATE(#{codiDate},'YYYY-MM-DD hh24:mi:ss'), #{codiWeather}, TO_DATE(#{choiceDate},'YYYY-MM-DD hh24:mi:ss'), #{choiceWeather})			
		]]>
	</insert>
	
	<select id="getCodiBookList" resultType="com.vestis.vo.CodibookVo" parameterType="map">
		<![CDATA[
			select codi.no no, person.no otherNo, person.nicname otherNicname, 
			pro_img.db_name profile,
			codiimg.db_name codi,
			wear.db_name wear,
			choose, likes
			from codi, person, img wear, img codiimg, img pro_img,
			    (select count(like_person.person_no) likes
			     from like_person, codi clike
			     where clike.no = like_person.codi_no)
			where other_no = #{num}
		]]>
			<if test="purpose.equals('own')">
				and person_no = #{num}
			</if>
			<if test="purpose.equals('other')">
				and person_no != #{num}
			</if>
		<![CDATA[
			    and codi_no = codiimg.no
			    and codi_photo_no = wear.no
			    and profile_no = pro_img.no
			order by codi.no desc
		]]>
	</select>
	
	<update id="chooseClick" parameterType="int">
		<![CDATA[
			update codi
			set choose = 1
			where no = #{no}	
		]]>
	</update>
</mapper>